RewriteEngine On

RewriteCond %{HTTP_HOST} ^www\.firstibox\.com$ [NC]
RewriteRule ^(.*)$ https://firstibox.com/$1 [L,R=301]

RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [L,R=301]

Options -Indexes

DirectoryIndex index.html 

<FilesMatch "^\.ht">
    Require all denied
</FilesMatch>

# Enable CORS for API endpoints
<FilesMatch "\.(php)$">
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type"
</FilesMatch>

# Handle preflight OPTIONS requests
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

# Security headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"

# Add MIME types for video formats
AddType video/mp4 .mp4
AddType video/webm .webm
AddType video/ogg .ogv
AddType video/x-matroska .mkv
AddType video/avi .avi
AddType video/quicktime .mov

# Cache static files
<FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|mp4|webm|ogv|mkv|avi|mov)$">
    ExpiresActive On
    ExpiresDefault "access plus 1 month"
</FilesMatch>

# Prevent access to sensitive files
<FilesMatch "\.(sql|md)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Custom error pages (optional)
ErrorDocument 404 /index.php
ErrorDocument 500 /index.php

# Internally map clean URLs to .html files if they exist
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^ %{REQUEST_URI}.php [NC,L]